
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FlappyTurd</title>
  <link rel="icon" type="image/png" href="assets/poop.png" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    canvas { display: block; background: #87CEEB; margin: 0 auto; }
    #scoreBoard {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 24px;
      font-family: sans-serif;
      background: rgba(255,255,255,0.7);
      padding: 10px 20px;
      border-radius: 10px;
      z-index: 2;
    }
  </style>
</head>
<body>
  <div id="scoreBoard">Score: 0</div>
  <canvas id="gameCanvas" width="400" height="600"></canvas>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreBoard = document.getElementById('scoreBoard');
    const poopImg = new Image();
    const splatImg = new Image();
    const splatSound = new Audio('assets/splat.mp3');

    poopImg.src = 'assets/poop.png';
    splatImg.src = 'assets/splat.png';

    const poop = {
      x: 50,
      y: 150,
      width: 40,
      height: 40,
      gravity: 0.5,
      lift: -10,
      velocity: 0,
      splatted: false
    };

    let pipes = [];
    let score = 0;
    let highScore = localStorage.getItem('highScore') || 0;
    let gameOver = false;

    function flap() {
      if (!poop.splatted) {
        poop.velocity = poop.lift;
      } else {
        location.reload();
      }
    }

    document.addEventListener('keydown', flap);
    document.addEventListener('click', flap);
    document.addEventListener('touchstart', flap);

    function drawPoop() {
      const img = poop.splatted ? splatImg : poopImg;
      ctx.drawImage(img, poop.x, poop.y, poop.width, poop.height);
    }

    function drawPipe(pipe) {
      ctx.fillStyle = 'green';
      ctx.fillRect(pipe.x, 0, pipe.width, pipe.top);
      ctx.fillRect(pipe.x, pipe.top + pipe.gap, pipe.width, canvas.height);
    }

    function updatePipes() {
      if (frames % 90 === 0) {
        let top = Math.floor(Math.random() * 200) + 50;
        let gap = 150;
        pipes.push({ x: canvas.width, width: 50, top, gap });
      }
      pipes.forEach((pipe) => {
        pipe.x -= 2;
        drawPipe(pipe);

        if (
          poop.x + poop.width > pipe.x &&
          poop.x < pipe.x + pipe.width &&
          (poop.y < pipe.top || poop.y + poop.height > pipe.top + pipe.gap)
        ) {
          splat();
        }

        if (!pipe.counted && pipe.x + pipe.width < poop.x) {
          score++;
          scoreBoard.innerText = 'Score: ' + score;
          pipe.counted = true;
        }
      });
    }

    function splat() {
      poop.splatted = true;
      gameOver = true;
      splatSound.play();
      if (score > highScore) {
        localStorage.setItem('highScore', score);
        highScore = score;
      }
      scoreBoard.innerText = 'SPLAT! Score: ' + score + ' | High Score: ' + highScore + ' (Click to restart)';
    }

    function update() {
      if (gameOver) return;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawPoop();
      updatePipes();

      poop.velocity += poop.gravity;
      poop.y += poop.velocity;

      if (poop.y + poop.height > canvas.height || poop.y < 0) {
        splat();
      }
    }

    let frames = 0;
    function loop() {
      update();
      frames++;
      requestAnimationFrame(loop);
    }

    loop();
  </script>
</body>
</html>
